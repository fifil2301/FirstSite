<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сапер - Heck.ai</title>
    <style>
        /* Здесь будет CSS для стилизации игры */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .game-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            text-align: center;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #555;
        }

        .board-container {
            display: grid;
            /* Количество столбцов будет задаваться JavaScript в зависимости от размера поля */
            /* grid-template-columns: repeat(10, 30px); */
            border: 2px solid #ccc;
            background-color: #ddd;
            gap: 1px; /* Промежутки между ячейками */
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: #c0c0c0;
            border: 1px solid #808080;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            user-select: none; /* Запрещаем выделение текста */
        }

        .cell.revealed {
            background-color: #e0e0e0;
            border-color: #b0b0b0;
            cursor: default;
        }

        .cell.mine {
            background-color: #ff6b6b;
            color: white;
        }

        .cell.flagged {
            background-color: #ffd166;
            color: #333;
        }

        /* Цвета для чисел - теперь более разнообразные и случайные */
        /* Мы можем использовать более широкий спектр цветов или даже генерировать их */
        /* Для простоты, я расширю палитру, но можно сделать и динамическую генерацию в JS */
        .cell.number-1 { color: #0000ff; } /* Синий */
        .cell.number-2 { color: #008000; } /* Зеленый */
        .cell.number-3 { color: #ff0000; } /* Красный */
        .cell.number-4 { color: #000080; } /* Темно-синий */
        .cell.number-5 { color: #800000; } /* Бордовый */
        .cell.number-6 { color: #008080; } /* Бирюзовый */
        .cell.number-7 { color: #000000; } /* Черный */
        .cell.number-8 { color: #808080; } /* Серый */

        /* Дополнительные цвета для разнообразия, если чисел больше 8 или для более случайного вида */
        /* Можно использовать массив цветов в JS и применять их по индексу */
        .cell.random-color-1 { color: #8A2BE2; } /* BlueViolet */
        .cell.random-color-2 { color: #DAA520; } /* Goldenrod */
        .cell.random-color-3 { color: #20B2AA; } /* LightSeaGreen */
        .cell.random-color-4 { color: #FF4500; } /* OrangeRed */
        .cell.random-color-5 { color: #4B0082; } /* Indigo */
        .cell.random-color-6 { color: #DC143C; } /* Crimson */
        .cell.random-color-7 { color: #006400; } /* DarkGreen */
        .cell.random-color-8 { color: #4682B4; } /* SteelBlue */


        .reset-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .reset-button:hover {
            background-color: #45a049;
        }

        .message {
            margin-top: 15px;
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .message.win {
            color: #28a745; /* Зеленый для победы */
        }

        .message.lose {
            color: #dc3545; /* Красный для проигрыша */
        }
    </style>
</head>
<body>
    <h1>Сапер</h1>

    <div class="game-container">
        <div class="game-info">
            <div id="mines-left">Мины: 10</div>
            <div id="timer">Время: 0</div>
        </div>

        <div id="board-container" class="board-container">
            <!-- Ячейки поля будут генерироваться JavaScript -->
        </div>

        <button id="reset-button" class="reset-button">Начать заново</button>
        <div id="message" class="message"></div>
    </div>

    <script>
        const boardContainer = document.getElementById('board-container');
        const minesLeftDisplay = document.getElementById('mines-left');
        const timerDisplay = document.getElementById('timer');
        const resetButton = document.getElementById('reset-button');
        const messageDisplay = document.getElementById('message');

        const BOARD_SIZE = 10; // Размер поля (10x10)
        const NUM_MINES = 10; // Количество мин

        let board = [];
        let timerInterval;
        let timeElapsed = 0;
        let minesFlagged = 0;
        let cellsRevealed = 0;
        let gameOver = false;
        let firstClick = true; // Флаг для отслеживания первого клика

        // Массив цветов для чисел (можно расширить или генерировать)
        const numberColors = [
            '#0000ff', // 1: Синий
            '#008000', // 2: Зеленый
            '#ff0000', // 3: Красный
            '#000080', // 4: Темно-синий
            '#800000', // 5: Бордовый
            '#008080', // 6: Бирюзовый
            '#000000', // 7: Черный
            '#808080', // 8: Серый
            // Дополнительные цвета для разнообразия, если нужно
            '#8A2BE2', // BlueViolet
            '#DAA520', // Goldenrod
            '#20B2AA', // LightSeaGreen
            '#FF4500', // OrangeRed
            '#4B0082', // Indigo
            '#DC143C', // Crimson
            '#006400', // DarkGreen
            '#4682B4'  // SteelBlue
        ];

        // Инициализация игры
        function initializeGame() {
            board = [];
            timeElapsed = 0;
            minesFlagged = 0;
            cellsRevealed = 0;
            gameOver = false;
            firstClick = true; // Сбрасываем флаг при новой игре
            messageDisplay.textContent = '';
            messageDisplay.className = 'message'; // Сброс классов сообщения

            minesLeftDisplay.textContent = `Мины: ${NUM_MINES}`;
            timerDisplay.textContent = `Время: 0`;

            clearInterval(timerInterval);

            createBoard();
            renderBoard();
        }

        // Создание пустой доски
        function createBoard() {
            for (let r = 0; r < BOARD_SIZE; r++) {
                board[r] = [];
                for (let c = 0; c < BOARD_SIZE; c++) {
                    board[r][c] = {
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        minesAround: 0
                    };
                }
            }
        }

        // Размещение мин
        function placeMines(firstClickRow, firstClickCol) {
            let minesPlaced = 0;
            while (minesPlaced < NUM_MINES) {
                const r = Math.floor(Math.random() * BOARD_SIZE);
                const c = Math.floor(Math.random() * BOARD_SIZE);

                // Убеждаемся, что мина не ставится на ячейку первого клика
                // и не ставится на уже существующую мину
                if (!board[r][c].isMine && !(r === firstClickRow && c === firstClickCol)) {
                    board[r][c].isMine = true;
                    minesPlaced++;
                }
            }
        }

        // Расчет количества мин вокруг каждой ячейки
        function calculateNumbers() {
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    // Сбрасываем minesAround для пересчета
                    board[r][c].minesAround = 0;
                    if (!board[r][c].isMine) {
                        let count = 0;
                        // Проверяем 8 соседних ячеек
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                if (dr === 0 && dc === 0) continue; // Пропускаем саму ячейку

                                const nr = r + dr;
                                const nc = c + dc;

                                if (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) {
                                    if (board[nr][nc].isMine) {
                                        count++;
                                    }
                                }
                            }
                        }
                        board[r][c].minesAround = count;
                    }
                }
            }
        }

        // Отрисовка доски в HTML
        function renderBoard() {
            boardContainer.innerHTML = '';
            boardContainer.style.gridTemplateColumns = `repeat(${BOARD_SIZE}, 30px)`; // Устанавливаем количество столбцов

            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    const cellData = board[r][c];

                    if (cellData.isRevealed) {
                        cell.classList.add('revealed');
                        if (cellData.isMine) {
                            cell.classList.add('mine');
                            cell.innerHTML = '💣'; // Бомба
                        } else if (cellData.minesAround > 0) {
                            cell.textContent = cellData.minesAround;
                            // Применяем цвет из массива numberColors
                            // Используем minesAround - 1 как индекс, чтобы получить цвет для числа 1 из numberColors[0]
                            const colorIndex = (cellData.minesAround - 1) % numberColors.length;
                            cell.style.color = numberColors[colorIndex];
                            // Можно также добавить класс, если хотите использовать CSS-классы для цветов
                            // cell.classList.add(`number-${cellData.minesAround}`);
                        }
                    } else if (cellData.isFlagged) {
                        cell.classList.add('flagged');
                        cell.innerHTML = '🚩'; // Флажок
                    }

                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleCellRightClick); // Правая кнопка мыши
                    boardContainer.appendChild(cell);
                }
            }
        }

        // Обработчик клика по ячейке (левая кнопка)
        function handleCellClick(event) {
            if (gameOver) return;

            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);
            const cellData = board[r][c];

            if (cellData.isRevealed || cellData.isFlagged) return;

            // Логика для первого клика
            if (firstClick) {
                firstClick = false;
                // Запускаем таймер
                timerInterval = setInterval(updateTimer, 1000);

                // Размещаем мины, исключая ячейку первого клика
                placeMines(r, c);
                // Пересчитываем числа
                calculateNumbers();
            }

            // Теперь, после первого клика, можно обрабатывать как обычно
            if (cellData.isMine) {
                revealAllMines();
                endGame(false); // Проигрыш
            } else {
                // revealCell рекурсивно открывает соседние ячейки, если minesAround === 0
                revealCell(r, c);
                checkWin();
            }
            renderBoard();
        }

        // Обработчик клика по ячейке (правая кнопка)
        function handleCellRightClick(event) {
            event.preventDefault(); // Отменяем стандартное контекстное меню
            if (gameOver) return;

            const r = parseInt(event.target.dataset.row);
            const c = parseInt(event.target.dataset.col);
            const cellData = board[r][c];

            if (cellData.isRevealed) return;

            cellData.isFlagged = !cellData.isFlagged;
            if (cellData.isFlagged) {
                minesFlagged++;
            } else {
                minesFlagged--;
            }
            minesLeftDisplay.textContent = `Мины: ${NUM_MINES - minesFlagged}`;
            renderBoard();
            checkWin();
        }

        // Открытие ячейки
        function revealCell(r, c) {
            if (r < 0 || r >= BOARD_SIZE || c < 0 || c >= BOARD_SIZE) return; // Выход за границы
            const cellData = board[r][c];

            if (cellData.isRevealed || cellData.isFlagged || cellData.isMine) return;

            cellData.isRevealed = true;
            cellsRevealed++;

            if (cellData.minesAround === 0) {
                // Если вокруг нет мин, рекурсивно открываем 8 соседних ячеек
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr === 0 && dc === 0) continue; // Пропускаем саму ячейку
                        revealCell(r + dr, c + dc);
                    }
                }
            }
        }

        // Открытие всех мин при проигрыше
        function revealAllMines() {
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    if (board[r][c].isMine) {
                        board[r][c].isRevealed = true;
                    }
                }
            }
        }

        // Проверка на победу
        function checkWin() {
            const totalCells = BOARD_SIZE * BOARD_SIZE;
            const nonMineCells = totalCells - NUM_MINES;

            // Проверяем, все ли не-миновые ячейки открыты
            if (cellsRevealed === nonMineCells) {
                endGame(true); // Победа
            }
        }

        // Завершение игры
        function endGame(win) {
            gameOver = true;
            clearInterval(timerInterval);
            if (win) {
                messageDisplay.textContent = 'Поздравляем! Вы выиграли!';
                messageDisplay.classList.add('win');
            } else {
                messageDisplay.textContent = 'Вы проиграли! Нажмите "Начать заново".';
                messageDisplay.classList.add('lose');
            }
        }

        // Обновление таймера
        function updateTimer() {
            timeElapsed++;
            timerDisplay.textContent = `Время: ${timeElapsed}`;
        }

        // Обработчик кнопки "Начать заново"
        resetButton.addEventListener('click', initializeGame);

        // Запуск игры при загрузке страницы
        initializeGame();
    </script>
</body>
</html>
